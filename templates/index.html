<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Editor de PDF</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <h1>Editor de PDF</h1>
  <div id="upload-area">
    <div class="upload-icon">ðŸ“„</div>
    <button id="file-select-button">ELEGIR ARCHIVOS</button>
    <p>o soltar archivos aquÃ­</p>
    <input type="file" id="file-input" multiple accept=".pdf,.zip">
  </div>
  <div>
    <button id="process-button" disabled>Procesar</button>
    <a id="download-button" style="display:none;">Descargar ZIP</a>
  </div>
  <div id="progress-container" style="display:none;">
    <div id="progress-bar">0%</div>
    <div id="progress-step" style="margin-top:.5em;font-weight:bold;">Esperandoâ€¦</div>
  </div>
  <script>
    const fi  = document.getElementById('file-input'),
          sb  = document.getElementById('file-select-button'),
          pb  = document.getElementById('process-button'),
          db  = document.getElementById('download-button'),
          pc  = document.getElementById('progress-container'),
          bar = document.getElementById('progress-bar'),
          step= document.getElementById('progress-step');
    let files, job;

    sb.onclick = ()=>fi.click();
    fi.onchange = ()=>{
      if(fi.files.length){ files=fi.files; pb.disabled=false }
    };
    document.getElementById('upload-area')
      .addEventListener('drop', e=>{
        e.preventDefault(); fi.files=e.dataTransfer.files;
        files=fi.files; pb.disabled=false;
      });
    pb.onclick = async ()=>{
      pb.disabled=true; pc.style.display='block';
      bar.style.width='0%'; bar.textContent='0%'; step.textContent='Enviandoâ€¦';
      let fd=new FormData(); for(const f of files) fd.append('files',f);
      let res=await fetch('/upload/',{method:'POST',body:fd}),
          j=await res.json(); job=j.job_id;
      let iv = setInterval(async ()=>{
        let p=await (await fetch(`/progress/${job}`)).json();
        bar.style.width=`${p.pct}%`; bar.textContent=`${p.pct}%`;
        step.textContent=p.step;
        if(p.pct>=100){ clearInterval(iv);
          step.textContent='Listo'; db.href=`/download/${job}`;
          db.style.display='inline-block';
        }
      }, 1000);
    };
  </script>
</body>
</html>
